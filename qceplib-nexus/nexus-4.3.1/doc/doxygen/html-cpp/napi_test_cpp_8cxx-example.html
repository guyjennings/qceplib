<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>NeXus: napi_test_cpp.cxx</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NeXus
   &#160;<span id="projectnumber">1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">napi_test_cpp.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<p>Test program for the <a class="el" href="namespaceNeXus.html">NeXus</a> C++ Interface. This illustrates calling most of the functions for reading and writing a file</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;napiconfig.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="NeXusFile_8hpp.html" title="Definition of the NeXus C++ API.">NeXusFile.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> std::cout;</div>
<div class="line"><span class="keyword">using</span> std::endl;</div>
<div class="line"><span class="keyword">using</span> std::map;</div>
<div class="line"><span class="keyword">using</span> std::multimap;</div>
<div class="line"><span class="keyword">using</span> std::string;</div>
<div class="line"><span class="keyword">using</span> std::vector;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> std::string relativePathOf(<span class="keyword">const</span> std::string&amp; filenamestr) {</div>
<div class="line">  <span class="keywordtype">char</span> cwd[1024];</div>
<div class="line"></div>
<div class="line">  getcwd(cwd, <span class="keyword">sizeof</span>(cwd));</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> ( filenamestr.compare(0, strlen(cwd), cwd) == 0 )</div>
<div class="line">  {</div>
<div class="line">      <span class="keywordflow">return</span> filenamestr.substr(strlen(cwd)+1);  <span class="comment">// +1 to skip trailing /</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">      <span class="keywordflow">return</span> filenamestr;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> writeTest(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; filename, NXaccess create_code) {</div>
<div class="line">  <a name="_a0"></a><a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> file(filename, create_code);</div>
<div class="line">  <span class="comment">// create group</span></div>
<div class="line">  file.makeGroup(<span class="stringliteral">&quot;entry&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">  <span class="comment">// group attributes</span></div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;hugo&quot;</span>, <span class="stringliteral">&quot;namenlos&quot;</span>);</div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;cucumber&quot;</span>, <span class="stringliteral">&quot;passion&quot;</span>);</div>
<div class="line">  <span class="comment">// put string</span></div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;ch_data&quot;</span>, <span class="stringliteral">&quot;NeXus_data&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 2d array</span></div>
<div class="line">  vector&lt;int&gt; array_dims;</div>
<div class="line">  array_dims.push_back(5);</div>
<div class="line">  array_dims.push_back(4);</div>
<div class="line">  <span class="keywordtype">char</span> c1_array[5][4] = {{<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;b&#39;</span>, <span class="charliteral">&#39;c&#39;</span> ,<span class="charliteral">&#39;d&#39;</span>}, {<span class="charliteral">&#39;e&#39;</span>, <span class="charliteral">&#39;f&#39;</span>, <span class="charliteral">&#39;g&#39;</span> ,<span class="charliteral">&#39;h&#39;</span>}, </div>
<div class="line">                         {<span class="charliteral">&#39;i&#39;</span>, <span class="charliteral">&#39;j&#39;</span>, <span class="charliteral">&#39;k&#39;</span>, <span class="charliteral">&#39;l&#39;</span>}, {<span class="charliteral">&#39;m&#39;</span>, <span class="charliteral">&#39;n&#39;</span>, <span class="charliteral">&#39;o&#39;</span>, <span class="charliteral">&#39;p&#39;</span>},</div>
<div class="line">                         {<span class="charliteral">&#39;q&#39;</span>, <span class="charliteral">&#39;r&#39;</span>, <span class="charliteral">&#39;s&#39;</span> , <span class="charliteral">&#39;t&#39;</span>}};</div>
<div class="line">  file.makeData(<span class="stringliteral">&quot;c1_data&quot;</span>, <a name="a1"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa6a4cd249877e6b4b9d660968e0489673">NeXus::CHAR</a>, array_dims, <span class="keyword">true</span>);</div>
<div class="line">  file.putData(c1_array);</div>
<div class="line">  file.closeData();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 1d uint8 array</span></div>
<div class="line">  vector&lt;uint8_t&gt; i1_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">    i1_array.push_back(static_cast&lt;uint8_t&gt;(i+1));</div>
<div class="line">  }</div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;i1_data&quot;</span>, i1_array);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 1d int16 array</span></div>
<div class="line">  vector&lt;int16_t&gt; i2_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">    i2_array.push_back(1000*(i+1));</div>
<div class="line">  }</div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;i2_data&quot;</span>, i2_array);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 1d int32 data</span></div>
<div class="line">  vector&lt;int32_t&gt; i4_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">    i4_array.push_back(1000000*(i+1));</div>
<div class="line">  }</div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;i4_data&quot;</span>, i4_array);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 2d float data</span></div>
<div class="line">  vector&lt;float&gt; r4_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 5*4; i++) {</div>
<div class="line">    r4_array.push_back(static_cast&lt;float&gt;(i));</div>
<div class="line">  }</div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;r4_data&quot;</span>, r4_array, array_dims);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// 2d double data - slab test</span></div>
<div class="line">  vector&lt;double&gt; r8_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 5*4; i++) {</div>
<div class="line">    r8_array.push_back(static_cast&lt;double&gt;(i+20));</div>
<div class="line">  }</div>
<div class="line">  file.makeData(<span class="stringliteral">&quot;r8_data&quot;</span>, <a name="a2"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaae9bb6f4c2f04ef8d8cc797fc5eb26849">NeXus::FLOAT64</a>, array_dims, <span class="keyword">true</span>);</div>
<div class="line">  vector&lt;int&gt; slab_start;</div>
<div class="line">  slab_start.push_back(4);</div>
<div class="line">  slab_start.push_back(0);</div>
<div class="line">  vector&lt;int&gt; slab_size;</div>
<div class="line">  slab_size.push_back(1);</div>
<div class="line">  slab_size.push_back(4);</div>
<div class="line">  file.putSlab(&amp;(r8_array[16]), slab_start, slab_size);</div>
<div class="line">  slab_start[0] = 0;</div>
<div class="line">  slab_start[1] = 0;</div>
<div class="line">  slab_size[0]=4;</div>
<div class="line">  slab_size[1]=4;</div>
<div class="line">  file.putSlab(&amp;(r8_array[0]), slab_start, slab_size);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// add some attributes</span></div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;ch_attribute&quot;</span>, <span class="stringliteral">&quot;NeXus&quot;</span>);</div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;i4_attribute&quot;</span>, 42);</div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;r4_attribute&quot;</span>, 3.14159265);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// set up for creating a link</span></div>
<div class="line">  NXlink link = file.getDataID();</div>
<div class="line">  file.closeData();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// int64 tests</span></div>
<div class="line">  vector&lt;int64_t&gt; grossezahl;</div>
<div class="line"><span class="preprocessor">#if HAVE_LONG_LONG_INT</span></div>
<div class="line"><span class="preprocessor"></span>  grossezahl.push_back(12);</div>
<div class="line">  grossezahl.push_back(555555555555LL);</div>
<div class="line">  grossezahl.push_back(23);</div>
<div class="line">  grossezahl.push_back(777777777777LL);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>  grossezahl.push_back(12);</div>
<div class="line">  grossezahl.push_back(555555);</div>
<div class="line">  grossezahl.push_back(23);</div>
<div class="line">  grossezahl.push_back(77777);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="keywordflow">if</span> (create_code != NXACC_CREATE) {</div>
<div class="line">    file.writeData(<span class="stringliteral">&quot;grosszahl&quot;</span>, grossezahl);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// create a new group inside this one</span></div>
<div class="line">  file.makeGroup(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;NXdata&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// create a link</span></div>
<div class="line">  file.makeLink(link);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// compressed data</span></div>
<div class="line">  array_dims[0] = 100;</div>
<div class="line">  array_dims[1] = 20;</div>
<div class="line">  vector&lt;int&gt; comp_array;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; array_dims[0]; i++) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; array_dims[1]; j++) {</div>
<div class="line">      comp_array.push_back(i);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  vector&lt;int&gt; cdims;</div>
<div class="line">  cdims.push_back(20);</div>
<div class="line">  cdims.push_back(20);</div>
<div class="line">  file.writeCompData(<span class="stringliteral">&quot;comp_data&quot;</span>, comp_array, array_dims, <a name="a3"></a><a class="code" href="group__cpp__types.html#gga91aeecf3fe8a235379682300feceb32dad4f64f2fdd1f22e34d6bccb296ac9b95">NeXus::LZW</a>, cdims);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// ---------- Test write Extendible Data --------------------------</span></div>
<div class="line">  std::vector&lt;int&gt; data(10, 123);</div>
<div class="line">  file.makeGroup(<span class="stringliteral">&quot;extendible_data&quot;</span>, <span class="stringliteral">&quot;NXdata&quot;</span>, 1);</div>
<div class="line">  file.writeExtendibleData(<span class="stringliteral">&quot;mydata1&quot;</span>, data);</div>
<div class="line">  file.writeExtendibleData(<span class="stringliteral">&quot;mydata2&quot;</span>, data, 1000);</div>
<div class="line">  std::vector&lt;int64_t&gt; dims(2);</div>
<div class="line">  dims[0] = 5;</div>
<div class="line">  dims[1] = 2;</div>
<div class="line">  std::vector&lt;int64_t&gt; chunk(2, 2);</div>
<div class="line">  file.writeExtendibleData(<span class="stringliteral">&quot;my2Ddata&quot;</span>, data, dims, chunk);</div>
<div class="line">  file.putAttr(<span class="stringliteral">&quot;string_attrib&quot;</span>, <span class="stringliteral">&quot;some short string&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Data vector can grow</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;6; i++)</div>
<div class="line">    data.push_back(456);</div>
<div class="line">  data[0]=789;</div>
<div class="line">  file.writeUpdatedData(<span class="stringliteral">&quot;mydata1&quot;</span>, data);</div>
<div class="line"></div>
<div class="line">  dims[0] = 8;</div>
<div class="line">  dims[1] = 2;</div>
<div class="line">  file.writeUpdatedData(<span class="stringliteral">&quot;my2Ddata&quot;</span>, data, dims);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Data vector can also shrink!</span></div>
<div class="line">  data.clear();</div>
<div class="line">  data.resize(5, 234);</div>
<div class="line">  file.writeUpdatedData(<span class="stringliteral">&quot;mydata2&quot;</span>, data);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Exit the group</span></div>
<div class="line">  file.closeGroup();</div>
<div class="line">  <span class="comment">// ---------- End Test write Extendible Data --------------------------</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// simple flush test</span></div>
<div class="line">  file.flush();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// real flush test</span></div>
<div class="line">  file.makeData(<span class="stringliteral">&quot;flush_data&quot;</span>, NeXus::getType&lt;int&gt;(), NX_UNLIMITED, <span class="keyword">true</span>);</div>
<div class="line">  vector&lt;int&gt; slab_array;</div>
<div class="line">  slab_array.push_back(0);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i &lt; 7; i++) {</div>
<div class="line">    slab_array[0] = i;</div>
<div class="line">    file.putSlab(slab_array, i, 1);</div>
<div class="line">    file.flush();</div>
<div class="line">    file.openData(<span class="stringliteral">&quot;flush_data&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  file.closeData();</div>
<div class="line">  file.closeGroup();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// create a sample</span></div>
<div class="line">  file.makeGroup(<span class="stringliteral">&quot;sample&quot;</span>, <span class="stringliteral">&quot;NXsample&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">  file.writeData(<span class="stringliteral">&quot;ch_data&quot;</span>, <span class="stringliteral">&quot;NeXus sample&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// make more links</span></div>
<div class="line">  NXlink glink = file.getGroupID();</div>
<div class="line">  file.openPath(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line">  file.makeGroup(<span class="stringliteral">&quot;link&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">  file.makeLink(glink);</div>
<div class="line">  file.makeNamedLink(<span class="stringliteral">&quot;renLinkGroup&quot;</span>, glink);</div>
<div class="line">  file.makeNamedLink(<span class="stringliteral">&quot;renLinkData&quot;</span>, link);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> NumT&gt;</div>
<div class="line"><span class="keywordtype">string</span> toString(<span class="keyword">const</span> vector&lt;NumT&gt; &amp; data) {</div>
<div class="line">  std::stringstream result;</div>
<div class="line">  result &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line">  <span class="keywordtype">size_t</span> size = data.size();</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; size; i++) {</div>
<div class="line">    result &lt;&lt; data[i];</div>
<div class="line">    <span class="keywordflow">if</span> (i+1 &lt; size) {</div>
<div class="line">      result &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  result &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">  <span class="keywordflow">return</span> result.str();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> readTest(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; filename) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">string</span> SDS(<span class="stringliteral">&quot;SDS&quot;</span>);</div>
<div class="line">  <span class="comment">// top level file information</span></div>
<div class="line">  <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> file(filename);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;NXinquirefile found: &quot;</span> &lt;&lt; relativePathOf(file.inquireFile()) &lt;&lt; endl;</div>
<div class="line">  vector&lt;NeXus::AttrInfo&gt; attr_infos = file.getAttrInfos();</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Number of global attributes: &quot;</span> &lt;&lt; attr_infos.size() &lt;&lt; endl;</div>
<div class="line">  <span class="keywordflow">for</span> (vector&lt;NeXus::AttrInfo&gt;::iterator it = attr_infos.begin();</div>
<div class="line">       it != attr_infos.end(); it++) {</div>
<div class="line">    <span class="keywordflow">if</span> (it-&gt;name != <span class="stringliteral">&quot;file_time&quot;</span> &amp;&amp; it-&gt;name != <span class="stringliteral">&quot;HDF_version&quot;</span> &amp;&amp; it-&gt;name !=  <span class="stringliteral">&quot;HDF5_Version&quot;</span> &amp;&amp; it-&gt;name != <span class="stringliteral">&quot;XML_version&quot;</span>) {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; it-&gt;name &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (it-&gt;type == <a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa6a4cd249877e6b4b9d660968e0489673">NeXus::CHAR</a>) {</div>
<div class="line">          cout &lt;&lt; file.getStrAttr(*it);</div>
<div class="line">        }</div>
<div class="line">        cout &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// check group attributes</span></div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;entry&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>);</div>
<div class="line">  attr_infos = file.getAttrInfos();</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Number of group attributes: &quot;</span> &lt;&lt; attr_infos.size() &lt;&lt; endl;</div>
<div class="line">  <span class="keywordflow">for</span> (vector&lt;NeXus::AttrInfo&gt;::iterator it = attr_infos.begin();</div>
<div class="line">       it != attr_infos.end(); it++) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; it-&gt;name &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (it-&gt;type == <a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa6a4cd249877e6b4b9d660968e0489673">NeXus::CHAR</a>) {</div>
<div class="line">      cout &lt;&lt; file.getStrAttr(*it);</div>
<div class="line">    }</div>
<div class="line">    cout &lt;&lt; endl;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// print out the entry level fields</span></div>
<div class="line">  map&lt;string, string&gt; entries = file.getEntries();</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Group contains &quot;</span> &lt;&lt; entries.size() &lt;&lt; <span class="stringliteral">&quot; items&quot;</span> &lt;&lt; endl;</div>
<div class="line">  <a name="_a4"></a><a class="code" href="structNeXus_1_1Info.html" title="This structure holds the type and dimensions of a primative field/array.">NeXus::Info</a> info;</div>
<div class="line">  <span class="keywordflow">for</span> (map&lt;string,string&gt;::const_iterator it = entries.begin();</div>
<div class="line">       it != entries.end(); it++) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; it-&gt;first;</div>
<div class="line">    <span class="keywordflow">if</span> (it-&gt;second == SDS) {</div>
<div class="line">      file.openData(it-&gt;first);</div>
<div class="line">      info = file.getInfo();</div>
<div class="line">      cout &lt;&lt; toString(info.<a name="a5"></a><a class="code" href="structNeXus_1_1Info.html#a7f161e88fbae241d905507109bee2b2a" title="The dimensions of the file.">dims</a>) &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (info.<a name="a6"></a><a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa6a4cd249877e6b4b9d660968e0489673">NeXus::CHAR</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a7f161e88fbae241d905507109bee2b2a" title="The dimensions of the file.">dims</a>.size()==1) {</div>
<div class="line">          cout &lt;&lt; file.getStrData();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;2d character array&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a7"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaaded5a39a253b4fd33329fc4213dd4f37">NeXus::FLOAT32</a>) {</div>
<div class="line">        vector&lt;float&gt; * result = file.getData&lt;<span class="keywordtype">float</span>&gt;();</div>
<div class="line">        cout &lt;&lt; toString(*result);</div>
<div class="line">        <span class="keyword">delete</span> result;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaae9bb6f4c2f04ef8d8cc797fc5eb26849">NeXus::FLOAT64</a>) {</div>
<div class="line">        vector&lt;double&gt;  * result = file.getData&lt;<span class="keywordtype">double</span>&gt;();</div>
<div class="line">        cout &lt;&lt; toString(*result);</div>
<div class="line">        <span class="keyword">delete</span> result;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a8"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa242465baaab364cf32355e0cc400742d">NeXus::INT8</a>) {</div>
<div class="line">        vector&lt;int8_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a9"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaaed10063deeacfa0b5b0429a7de451bde">NeXus::UINT8</a>) {</div>
<div class="line">        vector&lt;uint8_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a10"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaaa7e93117d8c4a6c67ae1798170323e71">NeXus::INT16</a>) {</div>
<div class="line">        vector&lt;int16_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a11"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa170129cd51859c4c7e1f6ca47e63b0ac">NeXus::UINT16</a>) {</div>
<div class="line">        vector&lt;uint16_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a12"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa60f8c2211c19fcdaeb0fde1158428ae6">NeXus::INT32</a>) {</div>
<div class="line">        vector&lt;int32_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a13"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa1ac7c17bd7dd87848f88beedf3807581">NeXus::UINT32</a>) {</div>
<div class="line">        vector&lt;uint32_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a14"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaa7ce5ef72d8f89e4ef849156905aea738">NeXus::INT64</a>) {</div>
<div class="line">        vector&lt;int64_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="structNeXus_1_1Info.html#a6c36977515a944e5f7172840ae9b5989" title="The primative type for the field.">type</a> == <a name="a15"></a><a class="code" href="group__cpp__types.html#ggad061c8f4e82763d6c0236dbd62998bbaaecfaef7245cb34644b7344f16dac4388">NeXus::UINT64</a>) {</div>
<div class="line">        vector&lt;uint64_t&gt; result;</div>
<div class="line">        file.getData(result);</div>
<div class="line">        cout &lt;&lt; toString(result);</div>
<div class="line">      }</div>
<div class="line">      cout &lt;&lt;  endl;</div>
<div class="line">      cout &lt;&lt; <span class="stringliteral">&quot;   Path = &quot;</span> &lt;&lt; file.getPath() &lt;&lt; endl;</div>
<div class="line">      file.closeData();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      cout &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; it-&gt;second &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Test getDataCoerce() -------------------</span></div>
<div class="line">        std::vector&lt;int&gt; ints;</div>
<div class="line">        std::vector&lt;double&gt; doubles;</div>
<div class="line">        </div>
<div class="line">        ints.clear();</div>
<div class="line">        file.openData(<span class="stringliteral">&quot;i1_data&quot;</span>);</div>
<div class="line">        file.getDataCoerce(ints);</div>
<div class="line">        <span class="keywordflow">if</span> (ints.size() != 4) <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">if</span> (ints[0] != 1) <span class="keywordflow">return</span> 1;</div>
<div class="line">        file.closeData();</div>
<div class="line"></div>
<div class="line">        ints.clear();</div>
<div class="line">        file.openData(<span class="stringliteral">&quot;i2_data&quot;</span>);</div>
<div class="line">        file.getDataCoerce(ints);</div>
<div class="line">        <span class="keywordflow">if</span> (ints.size() != 4) <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">if</span> (ints[0] != 1000) <span class="keywordflow">return</span> 1;</div>
<div class="line">        file.closeData();</div>
<div class="line"></div>
<div class="line">        ints.clear();</div>
<div class="line">        file.openData(<span class="stringliteral">&quot;i4_data&quot;</span>);</div>
<div class="line">        file.getDataCoerce(ints);</div>
<div class="line">        <span class="keywordflow">if</span> (ints.size() != 4) <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">if</span> (ints[0] != 1000000) <span class="keywordflow">return</span> 1;</div>
<div class="line">        file.closeData();</div>
<div class="line"></div>
<div class="line">        doubles.clear();</div>
<div class="line">        file.openData(<span class="stringliteral">&quot;r4_data&quot;</span>);</div>
<div class="line">        file.getDataCoerce(doubles);</div>
<div class="line">        <span class="keywordflow">if</span> (doubles.size() != 20) <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">if</span> (doubles[1] != 1.0) <span class="keywordflow">return</span> 1;</div>
<div class="line">        file.closeData();</div>
<div class="line"></div>
<div class="line">        doubles.clear();</div>
<div class="line">        file.openData(<span class="stringliteral">&quot;r8_data&quot;</span>);</div>
<div class="line">        file.getDataCoerce(doubles);</div>
<div class="line">        <span class="keywordflow">if</span> (doubles.size() != 20) <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">if</span> (doubles[1] != 21.0) <span class="keywordflow">return</span> 1;</div>
<div class="line">        file.closeData();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Throws when you coerce to int from a real/double source</span></div>
<div class="line">        <span class="keywordtype">bool</span> didThrow = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">try</span> </div>
<div class="line">        {</div>
<div class="line">                ints.clear();</div>
<div class="line">                file.openData(<span class="stringliteral">&quot;r8_data&quot;</span>);</div>
<div class="line">                file.getDataCoerce(ints);</div>
<div class="line">                file.closeData();</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;getDataCoerce(int) of doubles did not throw (it is supposed to throw).&quot;</span> &lt;&lt; endl;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">catch</span> (...)</div>
<div class="line">        {</div>
<div class="line">                <span class="comment">// Good! It is supposed to throw</span></div>
<div class="line">                didThrow = <span class="keyword">true</span>;</div>
<div class="line">                file.closeData();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!didThrow) <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Close the &quot;entry&quot; group</span></div>
<div class="line">  file.closeGroup();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// check links</span></div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;entry&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>);</div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;sample&quot;</span>, <span class="stringliteral">&quot;NXsample&quot;</span>);</div>
<div class="line">  NXlink glink = file.getGroupID();</div>
<div class="line">  file.closeGroup();</div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;NXdata&quot;</span>);</div>
<div class="line">  file.openData(<span class="stringliteral">&quot;r8_data&quot;</span>);</div>
<div class="line">  NXlink dlink = file.getDataID();</div>
<div class="line">  file.closeData();</div>
<div class="line">  file.closeGroup();</div>
<div class="line">  file.openData(<span class="stringliteral">&quot;r8_data&quot;</span>);</div>
<div class="line">  NXlink d2link = file.getDataID();</div>
<div class="line">  file.closeData();</div>
<div class="line">  <span class="keywordflow">if</span> (!file.sameID(dlink, d2link)) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Link check FAILED (r8_data)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     original data = &quot;</span>;</div>
<div class="line">    file.printLink(dlink);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     linked data = &quot;</span>;</div>
<div class="line">    file.printLink(d2link);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  file.closeGroup();</div>
<div class="line"></div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;link&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>);</div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;sample&quot;</span>, <span class="stringliteral">&quot;NXsample&quot;</span>);</div>
<div class="line">  NXlink g2link = file.getGroupID();</div>
<div class="line">  <span class="keywordflow">if</span> (!file.sameID(glink, g2link)) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Link check FAILED (sample)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     original group = &quot;</span>;</div>
<div class="line">    file.printLink(glink);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     linked group = &quot;</span>;</div>
<div class="line">    file.printLink(g2link);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  file.closeGroup();</div>
<div class="line"></div>
<div class="line">  file.openGroup(<span class="stringliteral">&quot;renLinkGroup&quot;</span>, <span class="stringliteral">&quot;NXsample&quot;</span>);</div>
<div class="line">  g2link = file.getGroupID();</div>
<div class="line">  file.closeGroup();</div>
<div class="line">  <span class="keywordflow">if</span> (!file.sameID(glink, g2link)) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Link check FAILED (renLinkGroup)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     original group = &quot;</span>;</div>
<div class="line">    file.printLink(glink);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     linked group = &quot;</span>;</div>
<div class="line">    file.printLink(g2link);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  file.openData(<span class="stringliteral">&quot;renLinkData&quot;</span>);</div>
<div class="line">  d2link = file.getDataID();</div>
<div class="line">  file.closeData();</div>
<div class="line">  <span class="keywordflow">if</span> (!file.sameID(dlink, d2link)) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Link check FAILED (renLinkData)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     original data = &quot;</span>;</div>
<div class="line">    file.printLink(dlink);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;     linked data = &quot;</span>;</div>
<div class="line">    file.printLink(d2link);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  file.closeGroup();</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Link check OK&quot;</span> &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// openpath checks</span></div>
<div class="line">  file.openPath(<span class="stringliteral">&quot;/entry/data/comp_data&quot;</span>);</div>
<div class="line">  file.openPath(<span class="stringliteral">&quot;/entry/data/comp_data&quot;</span>);</div>
<div class="line">  file.openPath(<span class="stringliteral">&quot;../r8_data&quot;</span>);</div>
<div class="line">  printf(<span class="stringliteral">&quot;NXopenpath checks OK\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// everything went fine</span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> testLoadPath(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; filename) {</div>
<div class="line">  <span class="keywordflow">if</span>(getenv(<span class="stringliteral">&quot;NX_LOAD_PATH&quot;</span>) != NULL){</div>
<div class="line">    <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> file(filename);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Success loading NeXus file from path&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="comment">// cout &lt;&lt; file.inquireFile() &lt;&lt; endl; // DEBUG print</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> testExternal(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; fileext, NXaccess create_code){</div>
<div class="line">  <span class="keywordtype">string</span> filename(<span class="stringliteral">&quot;nxext_cpp&quot;</span> + fileext);</div>
<div class="line">  <span class="keywordtype">string</span> exturl1(<span class="stringliteral">&quot;nxfile://data/dmc01&quot;</span> + fileext+<span class="stringliteral">&quot;#entry1&quot;</span>);</div>
<div class="line">  <span class="keywordtype">string</span> exturl2(<span class="stringliteral">&quot;nxfile://data/dmc02&quot;</span> + fileext+<span class="stringliteral">&quot;#entry1&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// create the external link</span></div>
<div class="line">  <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> fileout(filename, create_code);</div>
<div class="line">  fileout.linkExternal(<span class="stringliteral">&quot;entry1&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>, exturl1);</div>
<div class="line">  fileout.linkExternal(<span class="stringliteral">&quot;entry2&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>, exturl2);</div>
<div class="line">  fileout.close();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// read the file to make sure things worked</span></div>
<div class="line">  <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> filein(filename);</div>
<div class="line">  filein.openPath(<span class="stringliteral">&quot;/entry1/start_time&quot;</span>);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;First file time: &quot;</span> &lt;&lt; filein.getStrData() &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;NXinquirefile found: &quot;</span> &lt;&lt; relativePathOf(filein.inquireFile()) &lt;&lt; endl;</div>
<div class="line">  filein.openPath(<span class="stringliteral">&quot;/entry2/sample/sample_name&quot;</span>);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Second file sample: &quot;</span> &lt;&lt; filein.getStrData() &lt;&lt; endl;</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;NXinquirefile found: &quot;</span> &lt;&lt; relativePathOf(filein.inquireFile()) &lt;&lt; endl;</div>
<div class="line">  filein.openPath(<span class="stringliteral">&quot;/entry2/start_time&quot;</span>);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;Second file time: &quot;</span> &lt;&lt; filein.getStrData() &lt;&lt; endl;</div>
<div class="line">  filein.openPath(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line">  cout &lt;&lt; <span class="stringliteral">&quot;entry1 external URL = &quot;</span></div>
<div class="line">       &lt;&lt; filein.isExternalGroup(<span class="stringliteral">&quot;entry1&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>) &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> streamTest(<span class="keyword">const</span> std::string&amp; fname, NXaccess create_mode)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span>NeXus;</div>
<div class="line">    <span class="keyword">using namespace </span>NeXus::Stream;</div>
<div class="line">    std::vector&lt;double&gt; w;</div>
<div class="line">    std::vector&lt;double&gt; w1;</div>
<div class="line">    w.push_back(1.0);</div>
<div class="line">    <span class="keywordtype">double</span> d, d1;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="comment">// create an entry and a data item</span></div>
<div class="line">    <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">File</a> nf(fname, create_mode);</div>
<div class="line">    nf &lt;&lt; <a name="_a16"></a><a class="code" href="classNeXus_1_1Stream_1_1Group.html" title="Serialisable NeXus group object.">Group</a>(<span class="stringliteral">&quot;entry1&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>) &lt;&lt; <a name="_a17"></a><a class="code" href="classNeXus_1_1Stream_1_1Data.html" title="Serialisable data object that contains attributes.">Data</a>(<span class="stringliteral">&quot;dat1&quot;</span>, w, <span class="stringliteral">&quot;int_attr&quot;</span>, 3);</div>
<div class="line">    nf.close();</div>
<div class="line">    <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">File</a> nf1(fname, NXACC_RDWR);</div>
<div class="line">    <span class="comment">// add a double_attr to an existing setup</span></div>
<div class="line">    nf1 &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Group.html" title="Serialisable NeXus group object.">Group</a>(<span class="stringliteral">&quot;entry1&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>) &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Data.html" title="Serialisable data object that contains attributes.">Data</a>(<span class="stringliteral">&quot;dat1&quot;</span>) &lt;&lt; <a name="_a18"></a><a class="code" href="classNeXus_1_1Stream_1_1Attr.html" title="Serialisable attribute.">Attr</a>(<span class="stringliteral">&quot;double_attr&quot;</span>, 6.0) &lt;&lt; <a name="a19"></a><a class="code" href="group__cpp__stream.html#ggac5d3e7714393f66e15ac702107424906a70010302e0cc34b7bc94b772c6c5d854">Close</a>;</div>
<div class="line">    nf1.close();</div>
<div class="line">    <span class="comment">// read back data items</span></div>
<div class="line">    <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">File</a> nf2(fname, NXACC_READ);</div>
<div class="line">    nf2 &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Group.html" title="Serialisable NeXus group object.">Group</a>(<span class="stringliteral">&quot;entry1&quot;</span>, <span class="stringliteral">&quot;NXentry&quot;</span>) &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Data.html" title="Serialisable data object that contains attributes.">Data</a>(<span class="stringliteral">&quot;dat1&quot;</span>, w1, <span class="stringliteral">&quot;int_attr&quot;</span>, i, <span class="stringliteral">&quot;double_attr&quot;</span>, d);</div>
<div class="line">    <span class="comment">// alternative way to read d1</span></div>
<div class="line">    nf2 &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Data.html" title="Serialisable data object that contains attributes.">Data</a>(<span class="stringliteral">&quot;dat1&quot;</span>) &gt;&gt; <a class="code" href="classNeXus_1_1Stream_1_1Attr.html" title="Serialisable attribute.">Attr</a>(<span class="stringliteral">&quot;double_attr&quot;</span>, d1);</div>
<div class="line">    nf2.close();</div>
<div class="line">    <span class="keywordflow">if</span> (i != 3 || w != w1 || d != 6.0 || d1 != 6.0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> testTypeMap(<span class="keyword">const</span> std::string &amp;fname)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="classNeXus_1_1File.html" title="The Object that allows access to the information in the file.">NeXus::File</a> file(fname);</div>
<div class="line">        multimap&lt;string, string&gt; *map = file.getTypeMap();</div>
<div class="line">        <span class="keywordtype">size_t</span> mapsize = 25;</div>
<div class="line">        <span class="comment">// HDF4 does not have int64 capability, so resulting map is one shorter than HDF5 and XML files</span></div>
<div class="line">        <span class="keywordflow">if</span> (fname == <span class="keywordtype">string</span>(<span class="stringliteral">&quot;napi_test_cpp.hdf&quot;</span>)) {</div>
<div class="line">                <span class="keywordflow">if</span> (map-&gt;size() != (mapsize - 1))</div>
<div class="line">                {</div>
<div class="line">                        cout &lt;&lt; <span class="stringliteral">&quot;TypeMap is incorrect&quot;</span> &lt;&lt; endl;</div>
<div class="line">                        <span class="keywordflow">return</span> 1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (map-&gt;size() != mapsize)</div>
<div class="line">                {</div>
<div class="line">                        cout &lt;&lt; <span class="stringliteral">&quot;TypeMap is incorrect&quot;</span> &lt;&lt; endl;</div>
<div class="line">                        <span class="keywordflow">return</span> 1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;TypeMap is correct size&quot;</span> &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">  NXaccess nx_creation_code;</div>
<div class="line">  <span class="keywordtype">string</span> filename;</div>
<div class="line">  <span class="keywordtype">string</span> extfile_ext;</div>
<div class="line">  <span class="keywordflow">if</span>(strstr(argv[0],<span class="stringliteral">&quot;napi_test_cpp-hdf5&quot;</span>) != NULL){</div>
<div class="line">    nx_creation_code = NXACC_CREATE5;</div>
<div class="line">    filename = <span class="stringliteral">&quot;napi_test_cpp.h5&quot;</span>;</div>
<div class="line">    extfile_ext = <span class="stringliteral">&quot;.h5&quot;</span>;</div>
<div class="line">  }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(strstr(argv[0],<span class="stringliteral">&quot;napi_test_cpp-xml-table&quot;</span>) != NULL){</div>
<div class="line">    nx_creation_code = NXACC_CREATEXML | NXACC_TABLE;</div>
<div class="line">    filename = <span class="stringliteral">&quot;napi_test_cpp-table.xml&quot;</span>;</div>
<div class="line">    extfile_ext = <span class="stringliteral">&quot;-table.xml&quot;</span>;</div>
<div class="line">  }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(strstr(argv[0],<span class="stringliteral">&quot;napi_test_cpp-xml&quot;</span>) != NULL){</div>
<div class="line">    nx_creation_code = NXACC_CREATEXML;</div>
<div class="line">    filename = <span class="stringliteral">&quot;napi_test_cpp.xml&quot;</span>;</div>
<div class="line">    extfile_ext = <span class="stringliteral">&quot;.xml&quot;</span>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    nx_creation_code = NXACC_CREATE;</div>
<div class="line">    filename = <span class="stringliteral">&quot;napi_test_cpp.hdf&quot;</span>;</div>
<div class="line">    extfile_ext = <span class="stringliteral">&quot;.hdf&quot;</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> result;</div>
<div class="line">  result = writeTest(filename, nx_creation_code);</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;writeTest failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> ( (argc &gt;= 2) &amp;&amp; !strcmp(argv[1], <span class="stringliteral">&quot;-q&quot;</span>) )</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">return</span> 0;   <span class="comment">//</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// try reading a file</span></div>
<div class="line">  result = readTest(filename);</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;readTest failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// try using the load path</span></div>
<div class="line">  result = testLoadPath(<span class="stringliteral">&quot;dmc01.hdf&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;testLoadPath failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// try external linking</span></div>
<div class="line">  result = testExternal(extfile_ext, nx_creation_code);</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;testExternal failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// quick test of stream interface</span></div>
<div class="line">  std::string fname = string(<span class="stringliteral">&quot;stream_test&quot;</span>) + extfile_ext;</div>
<div class="line">  result = streamTest(fname, nx_creation_code);</div>
<div class="line">  <span class="keyword">remove</span>(fname.c_str());</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;streamTest failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// test of typemap generation</span></div>
<div class="line">  result = testTypeMap(filename);</div>
<div class="line">  <span class="keywordflow">if</span> (result) {</div>
<div class="line">          cout &lt;&lt; <span class="stringliteral">&quot;testTypeMap failed&quot;</span> &lt;&lt; endl;</div>
<div class="line">          <span class="keywordflow">return</span> result;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// everything went ok</span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.1
</small></address>
</body>
</html>
